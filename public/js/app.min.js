var App=angular.module("App",[]);App.config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",a.defaults.headers.post["X-CSRF-TOKEN"]=angular.element('meta[name="_token"]').attr("content"),a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),App.run(["$rootScope","MessageFactory",function(a,b){a.baseUrl=angular.element("base").attr("href"),a.loading=!1,a.messages=b}]),App.service("ApiService",["$rootScope","$http","$timeout",function(a,b,c){return this.url=a.baseUrl+"api/v1/",this.get=function(a,b,c){this.request("GET",a,b,c)},this.post=function(a,b,c){this.request("POST",a,b,c)},this.patch=function(a,b,c){this.request("PATCH",a,b,c)},this.put=function(a,b,c){this.request("PUT",a,b,c)},this.request=function(a,d,e,f){var g={url:this.url+d,method:a};switch(a){case"GET":case"get":g.params=e;break;case"POST":case"post":case"PUT":case"put":case"PATCH":case"patch":g.data=$.param(e)}b(g).then(function(a){c(function(){f(a.data)},1e3)})},this}]),App.factory("AuthFactory",["$rootScope","$http","$timeout",function(a,b,c){var d=a.baseUrl,e={};return e.login=function(a,b){var c={url:d+"login/attempt",method:"POST",data:$.param(a)};e.request(c,b)},e.request=function(a,d){b(a).then(function(a){c(function(){d(a)},1e3)})},e}]),App.factory("MessageFactory",[function(){var a={},b=[];return a.add=function(a,c){b.push({type:a,message:c})},a.get=function(){return b},a.clear=function(){b=[]},a}]),App.service("ScheduleFactory",["ApiService",function(a){var b={};return b.create=function(b,c){a.post("schedules",b,c)},b.update=function(b,c){b._method="PUT",a.post("schedules/"+b.id,b,c)},b.search=function(b,c){a.get("schedules/search",b,c)},b}]),App.factory("StationFactory",["ApiService",function(a){var b={};return b.create=function(b,c){a.post("stations",b,c)},b.update=function(b,c){a.post("stations/"+b.id,b,c)},b}]),App.factory("TrainFactory",["ApiService",function(a){var b={};return b.create=function(b,c){a.post("trains",b,c)},b.update=function(b,c){a.post("trains/"+b.id,b,c)},b}]),App.directive("btnSubmit",[function(){return{template:'<button type="submit" class="btn btn-success waves-effect waves-light"></button>',replace:!0,transclude:!0,restrict:"E",link:function(a,b,c){}}}]),App.directive("btnLink",[function(){return{template:'<a class="btn btn-info waves-effect waves-light" ng-transclude></a>',replace:!0,transclude:!0,restrict:"E",link:function(a,b,c){}}}]),App.directive("materialSelect",["$timeout",function(a){return{template:"<select></select>",transclude:!0,replace:!0,restrict:"E",link:function(b,c,d){a(function(){c.material_select()})}}}]),App.directive("preloaderCircle",[function(){return{templateUrl:"templates/preloader-circle.html",replace:!0,restrict:"E",link:function(a,b,c){}}}]),App.controller("AuthController",["$scope","$timeout","AuthFactory",function(a,b,c){a.form={username:"",password:""},a.login=function(d){d.preventDefault(),a.loading=!0,a.messages=[],c.login(a.form,function(c){c.data.status?(a.messages.push({type:"success",message:c.data.message}),b(function(){window.location=a.baseUrl},1e3)):(a.loading=!1,a.messages.push({type:"error",message:c.data.message}))})},window.scope=a}]),App.controller("HomeController",["$scope",function(a){}]),App.controller("ScheduleController",["$scope","$timeout","$filter","ScheduleFactory",function(a,b,c,d){a.create=function(c){c.preventDefault(),a.loading=!0;var e=a.filterDateTime(a.form);d.create(e,function(c){c.status?(a.messages.add("success",c.message),b(function(){window.location=c.redirect},1e3)):(a.loading=!1,a.messages.add("error",c.message))})},a.update=function(c){c.preventDefault(),a.loading=!0;var e=a.filterDateTime(a.form);console.log(e),d.update(e,function(c){c.status?(a.messages.add("success",c.message),b(function(){window.location=c.redirect},1e3)):(a.loading=!1,a.messages.add("error",c.message))})},a.search=function(b){b.preventDefault(),a.loading=!0,d.search(a.form,function(b){a.loading=!1,a.schedules=b.schedules})},a.canSearch=function(){return!a.form.departure&&!a.form.arrival||a.loading?"disabled":""},a.getDateTime=function(a){return"undefined"!=typeof a?new Date(a):new Date},a.getDataById=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return c},a.filterDateTime=function(a){var b=angular.copy(a);return b.departure_date=c("date")(b.departure_date,"yyyy-MM-dd"),b.arrival_date=c("date")(b.arrival_date,"yyyy-MM-dd"),b.departure_time=c("date")(b.departure_time,"HH:mm:ss"),b.arrival_time=c("date")(b.arrival_time,"HH:mm:ss"),b},window.scope=a}]),App.controller("StationController",["$scope","$timeout","StationFactory",function(a,b,c){a.submit=function(d,e){d.preventDefault(),a.loading=!0;var f=c[e];f(a.form,function(c){c.status?(a.messages.add("success",c.message),b(function(){window.location=c.redirect},1e3)):(a.loading=!1,a.messages.add("error",c.message))})},window.scope=a}]),App.controller("TrainController",["$scope","$timeout","TrainFactory",function(a,b,c){a.submit=function(d,e){d.preventDefault(),a.loading=!0,c[e](a.form,function(c){c.status?(a.messages.add("success",c.message),b(function(){window.location=c.redirect},1e3)):(a.loading=!1,a.messages.add("error",c.message))})},window.scope=a}]);